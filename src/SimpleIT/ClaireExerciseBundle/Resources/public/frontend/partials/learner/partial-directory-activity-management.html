<div style="float:left; flex:1; display:flex; margin-right: 2em;">
    <style>

        .collapsible:after {
            content: '\2227';
            margin-right: 0.5em;
            float:right;
        }

        .collapsible.active:after {
            content: "\2228";
            margin-right: 0.5em;
            float:right;
        }
        .collapsible{
            cursor: pointer;
            height:3em;
        }


        .pr-2{
            padding-right: 0.5em;
        }

        .mr-2{
            margin-right: 0.5em !important;
        }

        .ml-2{
            margin-left: 0.5em !important;
        }

        .flex-justified{
            display: flex;
        }

        .mb-2{
            margin-bottom: 0.5em;
        }

        .flex-49 {
            width: 49%;
        }
        body {
            padding-bottom: 0px !important;
        }

        .olm-loader,
        .olm-loader:after {
            border-radius: 50%;
            width: 10em;
            height: 10em;
        }
        .olm-loader {
            margin: 60px auto;
            font-size: 10px;
            position: relative;
            text-indent: -9999em;
            border-top: 1.1em solid rgba(66,139,202, 0.2);
            border-right: 1.1em solid rgba(66,139,202, 0.2);
            border-bottom: 1.1em solid rgba(66,139,202, 0.2);
            border-left: 1.1em solid #428bca;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation: olm-load 1.1s infinite linear;
            animation: olm-load 1.1s infinite linear;
        }
        @-webkit-keyframes olm-load {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        @keyframes olm-load {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }

    </style>
    <div style="display: flex; flex: 1; flex-direction: column; overflow-y: scroll; overflow-x: hidden; padding-right: 1em;">
        <h4>Mes objectifs</h4>
        <div id="objectives-header"><h5>Choix des objectifs</h5></div>
        <div class="flex-justified">
            <button id="retrieve-class-objectives-button" ng-click="retrieveClassObjectives(directory)" class="btn btn-primary mr-2 mb-2">Récupérer les objectifs de l'enseignant</button>
            <button id="retrieve-learner-objectives-button" ng-click="retrieveLearnerObjectives(directory)" class="btn btn-primary mb-2">Récupérer mes objectifs</button>
        </div>
        <div id="reset-objectives" class="d-none">
            <button id="reset-objectives-button" ng-click="resetObjectives(directory)" class="btn btn-primary w-100 p-2 mb-2">Enlever les objectifs</button>
        </div>
        <div ng-if="objectives.length === 0" id="no-objectives">Pas d'objectifs choisis pour les recommandations.</div>
        <div ng-if="objectives.length > 0" id="objectives-container">
            <div ng-repeat="objective in objectives">
                <div class="panel panel-default">
                    <div class="panel-heading" ng-include="BASE_CONFIG.urls.partials.learner+'/fragment-objective.html'" style="padding: 1em;">
                    </div>
                </div>
            </div>
        </div>
        <hr style="margin: 5px !important;"/>

        <h4>Mes recommandations</h4>
        <div class=""><button id="retrieve-recommandations-button" ng-click="requestRecommendations(directory, objectives)" class="btn btn-primary w-100 mb-2">Obtenir de nouvelles recommandations</button> </div>
        <div style="flex:1;">
                <div ng-repeat="recommendationNode in recommendationsNodes" class="panel panel-default">
                    <div id="panel-{{recommendationNode}}" class="panel-heading collapsible active" ng-click="collapse(recommendationNode);">
                        <h3 class="panel-title" style="float:left;">{{recommendationNode.replaceAll("_"," ");}}</h3>
                    </div>
                    <div id="content-{{recommendationNode}}" class="panel-body content" style="display:block;">
                        <div ng-repeat="recommendation in recommendations" ng-if="recommendationNode == recommendation.objectiveNode">
                            <div class="panel">
                                <div ng-include="BASE_CONFIG.urls.partials.learner+'/fragment-recommendation.html'">
                                </div>
                            </div>
                    </div>
                </div>

            </div>
        </div>
            </div>
    </div>

</div>
<div class="right" style="flex: 1; display:flex;flex-direction: column;">
    <h4>Mon profil</h4>
    <div style="padding-bottom: 1em;">
        <button ng-click="requestProfile(directory)" type="button" class="btn btn-primary">Mettre à jour mon profil</button>
        <select id="olm-options" data-directory-id="{{directory.id}}" class="hidden" onchange="ChangeOLMVisu(this)">
            <option value="0" selected>Arborescent</option>
            <option value="1">Stalactite </option>
            <option value="2">Bulles     </option>
            <option value="3">Sunburst   </option>
        </select>
    </div>

    <div style="flex:1; overflow-y: scroll; overflow-x: hidden;">
        <div id="olm-target-loader">
            <div class='olm-loader'></div>
            <p>
                Chargement du profil.
                Cette opéridation peut prendre plusieurs secondes, notamment lors de l'initialisation du profil...
            </p>
        </div>
        <div id="olm-target"></div>
    </div>

</div>
<div ng-include="BASE_CONFIG.urls.partials.learner+'/modal-objective-selection.html'">
</div>
<script>

    function ChangeOLMVisu(elem, directory){
        let value = parseInt(elem.value);
        let directoryId = elem.dataset.directoryId;
        let fw_tree = document._OLM.currentTree;
        let config = {
            "fontHoverColor":  "rgba(0, 0, 0, 1)",
            "fontColor":       "rgba(0, 0, 0, .85)",
            "backgroundColor": "rgba(255, 255, 255, .95)"
        };
        let OLM = document._OLM;
        document.getElementById('olm-target').innerHTML = '';
        let action = '';
        switch(value){
            case 0:
                let treeIndented = new OLM.TreeIndented(document.getElementById('olm-target'), fw_tree, config);
                treeIndented.onClick = (node) => {}
                treeIndented.onMouseEnter = (node) => {}
                treeIndented.draw(svgId = 'olm-target-indented');
                action = 'change to treeIndented';
                break;
            case 1:
                let treePartition = new OLM.TreePartition(document.getElementById('olm-target'), fw_tree, config);
                treePartition.onMouseOver = (node) => {}
                treePartition.draw(svgId = 'olm-target-partition');
                action = 'change to treePartition';
                break;
            case 2:
                let treePack = new OLM.TreePack(document.getElementById('olm-target'), fw_tree, config);
                console.log(treePack.viewBoxWidth+' : '+treePack.viewBoxHeight);
                treePack.onMouseOver = (node) => {}
                treePack.draw(svgId = 'olm-target-pack');
                action = 'change to treePack';
                break;
            case 3:
                let treeSunburst = new OLM.TreeSunburst(document.getElementById('olm-target'), fw_tree, config);
                treeSunburst.onMouseOver = (node) => {}
                treeSunburst.draw(svgId = 'olm-target-sunburst');
                action = 'change to treeSunburst';
                break;
        }
        $.ajax({
            //url:     "/app_dev.php/api/profile/trace/"+directoryId+'/'+action,
            url:     "/api/profile/trace/"+directoryId+'/'+action,
            type:    "POST",
            async:   true,
            success: function(data, textStatus){}
        });
    }
</script>

</div>